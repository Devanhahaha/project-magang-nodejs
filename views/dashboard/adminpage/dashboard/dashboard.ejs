<% var title="Dashboard" ; %>
<div class="container-fluid flex-grow-1 container-p-y">
  <div class="row g-6">
    <!-- News Card -->
    <div class="col-xl-4 col-md-6 mb-4">
      <div class="card border-left-info shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-xs font-weight-bold text-info text-uppercase mb-1">News</div>
              <div class="row no-gutters align-items-center">
                <div class="col-auto">
                  <div class="h5 mb-0 mr-3 font-weight-bold text-gray-800">
                    <%= totalNews %>
                  </div>
                </div>
                <div class="col">
                  <div class="progress progress-sm mr-2">
                    <div class="progress-bar bg-info"
                      role="progressbar"
                      style="width: <%= (persenNews || 0) %>%"
                      aria-valuenow="<%= persenNews %>"
                      aria-valuemin="0"
                      aria-valuemax="100">
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-auto">
              <i class="fas fa-clipboard-list fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Portfolio Card -->
    <div class="col-xl-4 col-md-6 mb-4">
      <div class="card border-left-info shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Portfolio</div>
              <div class="row no-gutters align-items-center">
                <div class="col-auto">
                  <div class="h5 mb-0 mr-3 font-weight-bold text-gray-800">
                    <%= totalPortofolio %>
                  </div>
                </div>
                <div class="col">
                  <div class="progress progress-sm mr-2">
                    <div class="progress-bar bg-info"
                      role="progressbar"
                      style="width: <%= persenPortofolio || 0 %>%"
                      aria-valuenow="<%= persenPortofolio %>"
                      aria-valuemin="0"
                      aria-valuemax="100">
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-auto">
              <i class="fas fa-clipboard-list fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Services Card -->
    <div class="col-xl-4 col-md-6 mb-4">
      <div class="card border-left-info shadow h-100 py-2">
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Services</div>
              <div class="row no-gutters align-items-center">
                <div class="col-auto">
                  <div class="h5 mb-0 mr-3 font-weight-bold text-gray-800">
                    <%= totalServices %>
                  </div>
                </div>
                <div class="col">
                  <div class="progress progress-sm mr-2">
                    <div class="progress-bar bg-info"
                      role="progressbar"
                      style="width: <%= persenServices || 0 %>%"
                      aria-valuenow="<%= persenServices %>"
                      aria-valuemin="0"
                      aria-valuemax="100">
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-auto">
              <i class="fas fa-clipboard-list fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Welcome Card -->
    <div class="col-12">
      <div class="card">
        <div class="d-flex align-items-end row">
          <div class="col-7">
            <div class="card-body text-nowrap">
              <h5 class="card-title mb-0">Welcome <%= user.name %>!üéâ</h5>
              <p class="mb-2">Hope you're having a productive day ‚òÄÔ∏è</p>
              <p class="mb-2">It's <%= currentDate %> ‚Äî let's make it count!</p>
              <a href="/portofolio" class="btn btn-primary">Check Activities</a>
            </div>
          </div>
          <div class="col-5 text-center text-sm-left">
            <div class="card-body pb-0 px-0 px-md-4">
              <img src="/dashboard/admin/assets/img/illustrations/card-advance-sale.png"
                height="140"
                alt="view sales"/>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Charts -->
    <div class="col-xxl-12 col-12">
      <div class="row g-4">
        <div class="col-xl-6 col-md-6">
          <div class="card h-100">
            <div class="card-header pb-0">
              <p class="card-subtitle">Jumlah Pengunjung</p>
            </div>
            <div class="card-body">
              <canvas id="profitLastMonth"></canvas>
              <div
                class="d-flex justify-content-between align-items-center mt-3 gap-3">
                <h4 class="mb-0"><%= totalVisitor %> Pengunjung</h4>
                <small class="text-success"><%= growth %>%</small>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xl-6 col-md-6">
          <div class="card h-100">
            <div class="card-header pb-2">
              <h5 class="card-title mb-1"><%= totalVisitor %> Pengunjung</h5>
            </div>
            <div class="card-body">
              <canvas id="expensesChart"></canvas>
              <div class="mt-3 text-center">
                <small class="text-muted mt-3"><%= growth %>%</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xxl-12 col-md-6">
      <div class="card h-100">
        <div class="card-header d-flex justify-content-between">
          <div class="card-title m-0 me-2">
            <h5 class="mb-1">Our Client</h5>
            <p class="card-subtitle">Total <%= totalClient %> Client</p>
          </div>
          <button class="btn btn-primary" data-bs-toggle="offcanvas" data-bs-target="#add-new-record">
            <i class="ti ti-plus"></i> Add New Client
          </button>
          <div class="offcanvas offcanvas-custom offcanvas-end" tabindex="-1" id="add-new-record">
            <div class="offcanvas-header border-bottom">
              <h5 class="offcanvas-title">Add New Client</h5>
              <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"></button>
            </div>
            <div class="offcanvas-body flex-grow-1">
              <form action="/client/store" method="POST" enctype="multipart/form-data">
                <div class="mb-3">
                  <label class="form-label" for="logoAdd">Logo</label>
                  <input type="file" id="logoAdd" name="logo" class="form-control" required />
                </div>
                <div class="mb-3">
                  <label class="form-label" for="name">Nama Client</label>
                  <input type="text" id="name" name="name" class="form-control" placeholder="Enter Name" required />
                </div>
                <div class="mt-4">
                  <button type="submit" class="btn btn-primary me-2">Submit</button>
                  <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="offcanvas">Cancel</button>
                </div>
              </form>
            </div>
          </div>
        </div>
        <div class="card-body">
          <ul class="p-0 m-0">
            <% clients.forEach(function(client){ %>
            <li class="d-flex mb-6">
              <div class="me-4">
                <a href="/client/detail/<%= client.name %>"><img src="/dashboard/storage/files/clients/<%= client.logo %>" alt="User" class="rounded" width="46" /></a>
              </div>
              <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
                <div class="me-2">
                  <h6 class="mb-0"><%= client.name %></h6>
                  <small class="text-body d-block"><% client.projects.forEach(project => { %>
                    <h6><%= project.name %></h6>
                  <% }) %></small>
                </div>
                <div class="d-flex align-items-center ms-auto gap-2">
                  <a class="btn btn-sm btn-outline-primary" href="#" data-bs-toggle="offcanvas"
                     data-bs-target="#edit-client-<%= client.id %>">
                    <i class="ti ti-pencil"></i>
                  </a>
                  <button class="btn btn-sm btn-outline-danger" onclick="confirmDeleteClient(<%= client.id %>)">
                    <i class="ti ti-trash"></i>
                  </button>
                </div>                
                <div class="offcanvas offcanvas-custom offcanvas-end" tabindex="-1" id="edit-client-<%= client.id %>">
                  <div class="offcanvas-header border-bottom">
                    <h5 class="offcanvas-title">Update Client</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
                  </div>
                  <div class="offcanvas-body">
                    <form action="/client/update/<%= client.id %>" method="POST" enctype="multipart/form-data">
                      <div class="mb-3">
                        <label class="form-label" for="logoEdit">Logo</label>
                        <input type="file" id="logoEdit" name="logo" class="form-control" />
                      </div>
                      <div class="mb-3">
                        <label class="form-label">Nama Aplikasi</label>
                        <input type="text" name="name" class="form-control" value="<%= client.name %>" required />
                      </div>
                      <div class="mb-3">
                        <label class="form-label" for="project_id">Pilih Project</label>
                        <select id="project_id" name="project_id" class="form-select">
                          <option value="">-- Pilih Project --</option>
                          <% projects.forEach(p => { %>
                            <option value="<%= p.id %>"><%= p.name %></option>
                          <% }) %>
                        </select>
                      </div>                      
                      <button type="submit" class="btn btn-primary">Update</button>
                      <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="offcanvas">Cancel</button>
                    </form>
                  </div>
                </div>
              </div>
            </li>
            <% }); %>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <div class="col-12 mt-4">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="card-title mb-0">Calendar <%= currentDate %></h5>
        <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addEventModal">Add Event</button>
      </div>
      <div class="card-body">
        <div id="simpleCalendar" class="calendar-grid"></div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="addEventModal" tabindex="-1" aria-labelledby="addEventModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <form action="/calendar/store" method="POST" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addEventModalLabel">Add Event</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="eventTitle" class="form-label">Title</label>
            <input type="text" class="form-control" id="eventTitle" name="title" required />
          </div>
          <div class="mb-5">
            <label class="form-label" for="eventLabel">Label</label>
            <select class="select2 select-event-label form-select" id="label" name="label">
              <option data-label="primary" value="business" selected>Business</option>
              <option data-label="danger" value="personal">Personal</option>
              <option data-label="success" value="hooliday">Hooliday</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="eventStart" class="form-label">Start Date</label>
            <input type="date" class="form-control" id="eventStart" name="start_date" required />
          </div>
          <div class="mb-3">
            <label for="eventEnd" class="form-label">End Date</label>
            <input type="date" class="form-control" id="eventEnd" name="end_date" required />
          </div>
          <div class="mb-3">
            <label for="eventEnd" class="form-label">Event Url</label>
            <input type="text" class="form-control" id="event_url" name="event_url" required />
          </div>
          <div class="mb-3">
            <label for="eventEnd" class="form-label">Guest</label>
            <input type="text" class="form-control" id="guest" name="guest" required />
          </div>
          <div class="mb-3">
            <label for="eventEnd" class="form-label">Location</label>
            <input type="text" class="form-control" id="location" name="location" required />
          </div>
          <div class="mb-3">
            <label for="eventDesc" class="form-label" for="description">Description</label>
            <textarea class="form-control" id="description" name="description"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Save Event</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        </div>
      </form>
    </div>
  </div>
  <div class="modal fade" id="editEventModal" tabindex="-1" aria-labelledby="editEventModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <form id="editEventForm" action="" method="POST" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editEventModalLabel">Edit Event</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="editEventTitle" class="form-label">Title</label>
            <input type="text" class="form-control" id="editEventTitle" name="title" required />
          </div>
          <div class="mb-3">
            <label for="editLabel" class="form-label">Label</label>
            <select class="form-select" id="editLabel" name="label">
              <option value="business">Business</option>
              <option value="personal">Personal</option>
              <option value="hooliday">Hooliday</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="editStartDate" class="form-label">Start Date</label>
            <input type="date" class="form-control" id="editStartDate" name="start_date" required />
          </div>
          <div class="mb-3">
            <label for="editEndDate" class="form-label">End Date</label>
            <input type="date" class="form-control" id="editEndDate" name="end_date" required />
          </div>
          <div class="mb-3">
            <label for="editEventUrl" class="form-label">Event URL</label>
            <input type="text" class="form-control" id="editEventUrl" name="event_url"/>
          </div>
          <div class="mb-3">
            <label for="editGuest" class="form-label">Guest</label>
            <input type="text" class="form-control" id="editGuest" name="guest"/>
          </div>
          <div class="mb-3">
            <label for="editLocation" class="form-label">Location</label>
            <input type="text" class="form-control" id="editLocation" name="location"/>
          </div>
          <div class="mb-3">
            <label class="form-label" for="editDescription">Description</label>
            <textarea id="editDescription" name="description" class="form-control" required></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Update Event</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        </div>
      </form>
    </div>
  </div>
  <div class="modal fade" id="viewEventsModal" tabindex="-1" aria-labelledby="viewEventsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="viewEventsModalLabel">
            Events on <span id="viewDate"></span>
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="eventList"></div>
      </div>
    </div>
  </div>
</div>
<form id="delete-form" method="POST" style="display: none"></form>
<%- include('../../layouts/dashboard.ejs') %>
